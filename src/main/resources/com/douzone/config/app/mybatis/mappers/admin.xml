<?xml version="1.0" encoding="UTF-8" ?> 

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
	
	<select id="getCompList" parameterType="string" resultType="companyvo">
		select a.comp_seq as compSeq, b.comp_cd as compCd, a.comp_name as compName 
		from t_co_comp_multi a, t_co_comp b
		where a.comp_seq = b.comp_seq
		and lang_code = #{langCode}
		order by a.comp_seq + 0;
	</select>
	
	<select id="getCompInfo" parameterType="string" resultType="companyvo">
		select a.comp_seq as compSeq, if(a.use_yn = 'Y', '사용', '미사용') as useYn, a.owner_name as ownerName, a.comp_regist_num as compRegistNum,
			a.comp_num as compNum, a.standard_code as standardCode, a.comp_cd as compCd, a.order_num as orderNum,
			a.biz_condition as bizCondition, a.item, a.tel_num as telNum, a.fax_num as faxNum, a.zip_code as zipCode,
		    a.addr, a.detail_addr as detailAddr, a.homepg_addr as homepgAddr, (case(a.native_lang_code)when'kr' then '한국어' else '영어' end) as nativeLangCode, 
		    a.comp_domain as compDomain, b.comp_name as compName, c.comp_name as compNameEn
		from
			(select a.comp_seq, a.use_yn, b.owner_name, a.comp_regist_num, a.comp_num, a.standard_code,
					a.comp_cd, a.order_num, b.biz_condition, b.item, a.tel_num, a.fax_num, a.zip_code,
			        b.addr, b.detail_addr, a.homepg_addr, a.native_lang_code, a.comp_domain
			from t_co_comp a, t_co_comp_multi b
			where a.comp_seq = b.comp_seq
			and b.lang_code = 'kr'
			and a.comp_seq = #{compSeq}) a
		left outer join t_co_comp_multi b
		on a.comp_seq = b.comp_seq
		and b.lang_code = 'kr'
		left outer join t_co_comp_multi c
		on a.comp_seq = c.comp_seq
		and c.lang_code = 'en'
	</select>
	
	<select id="getBizInfo" parameterType="string" resultType="bizvo">
		select a.biz_seq as bizSeq, a.comp_seq as compSeq, a.order_num as orderNum, if(a.use_yn = 'Y', '사용', '미사용') as useYn,
			 a.zip_code as zipCode, a.biz_name as bizName, a.biz_nickname as bizNickname, a.addr as addr, a.detail_addr as detailAddr, b.biz_name as bizNameEn
		from
			(select a.biz_seq, a.comp_seq, a.order_num, a.use_yn, a.zip_code, b.biz_name, b.biz_nickname, b.addr, b.detail_addr
			from t_co_biz a, t_co_biz_multi b
			where a.biz_seq = b.biz_seq
			and b.lang_code = 'kr'
			and a.biz_seq = #{bizSeq}) a
		left outer join t_co_biz_multi b
		on a.biz_seq = b.biz_seq
		and b.lang_code = 'en';
	</select>
	
	<select id="getDeptInfo" parameterType="string" resultType="departmentsvo">
		select a.dept_seq as deptSeq, a.parent_dept_seq as parentDeptSeq, a.order_num as orderNum, if(a.use_yn = 'Y', '사용', '미사용') as useYn,
			 a.zip_code as zipCode, a.dept_name as deptName, a.dept_nickname as deptNickname, a.addr as addr, a.detail_addr as detailAddr, b.dept_name as deptNameEn
		from
			(select a.dept_seq, a.parent_dept_seq, a.order_num, a.use_yn, a.zip_code, b.dept_name, b.dept_nickname, b.addr, b.detail_addr
			from t_co_dept a, t_co_dept_multi b
			where a.dept_seq = b.dept_seq
			and b.lang_code = 'kr'
			and a.dept_seq = #{deptSeq}) a
		left outer join t_co_dept_multi b
		on a.dept_seq = b.dept_seq
		and b.lang_code = 'en';
	</select>
	
	<insert id="insertComp" parameterType="companyvo">
		insert into t_co_comp values(#{compSeq}, 'demo', #{compCd}, '0', 'B', #{compRegistNum},
		 #{compNum}, #{standardCode}, 'Y', #{telNum}, #{faxNum}, #{homepgAddr}, null, #{compDomain}, null,
		  '', #{zipCode}, 'N', null, null, #{nativeLangCode}, (select max(a.order_num)+1 from t_co_comp a), #{useYn}, 'eap', '0101', now(),
		   null, null, 'N', 'N', 'N')
	</insert>
	
	<insert id="insertCompMulti" parameterType="companyvo">
		insert into t_co_comp_multi values(#{compSeq}, #{langCode}, 'demo', #{compName}, null,
		 #{ownerName}, null, #{bizCondition}, #{item}, #{addr}, #{detailAddr}, #{useYn}, '1010', now(), null, null, #{compNickname})
	</insert>
	
	<delete id="deleteComp" parameterType="companyvo">
		delete from t_co_comp where comp_seq = #{compSeq}
	</delete>
	
	<delete id="deleteCompMulti" parameterType="companyvo">
		delete from t_co_comp_multi where comp_seq = #{compSeq} and lang_code = #{langCode}
	</delete>
	
	<update id="updateComp" parameterType="companyvo">
		update t_co_comp set comp_cd = #{compCd}, comp_regist_num = #{compRegistNum}, comp_num = #{compNum},
							standard_code = #{standardCode}, tel_num = #{telNum}, fax_num = #{faxNum}, homepg_addr = #{homepgAddr},
							comp_domain = #{compDomain}, zip_code = #{zipCode}, native_lang_code = #{nativeLangCode}, order_num = #{orderNum},
							 use_yn = #{useYn}, modify_seq = '0101', modify_date = now() 
						where comp_seq = #{compSeq}
	</update>
	
	<update id="updateCompMulti" parameterType="companyvo">
		update t_co_comp_multi set comp_name = #{compName}, owner_name = #{ownerName},
								biz_condition = #{bizCondition}, item = #{item}, addr = #{addr}, detail_addr = #{detailAddr},
								use_yn = #{useYn}, modify_seq = '0101', modify_date = now()
							where comp_seq = #{compSeq}
							and lang_code = #{langCode}
	</update>
	
	<insert id="updateCompHistory" parameterType="companyvo">
		insert into t_co_comp_history values( (select max(a.seq)+1 from t_co_comp_history a), 
		<choose>
			<when test="opCode eq 'I'.toString()">
				'I',
			</when>
			<when test="opCode eq 'U'.toString()">
				'U',
			</when>
			<otherwise>
				'D',
			</otherwise>
		</choose>
		 now(), #{groupSeq}, #{compSeq}, null, #{loginType}, #{compRegistNum},
		 #{compNum}, #{standardCode}, #{telNum}, #{faxNum}, #{homepgAddr}, #{compDomain}, #{emailAddr}, #{emailDomain}, #{zipCode}, null, null, #{nativeLangCode}, #{orderNum}, #{useYn},
		  #{eaType}, #{createSeq}, #{createDate}, #{modifySeq}, #{modifyDate}, 'N', 'N', 'N')
	</insert>
	
	<insert id="updateCompMultiHistory" parameterType="companyvo">
		insert into t_co_comp_multi_history values( (select max(a.seq)+1 from t_co_comp_multi_history a), 
		<choose>
			<when test="opCode eq 'I'.toString()">
				'I',
			</when>
			<when test="opCode eq 'U'.toString()">
				'U',
			</when>
			<otherwise>
				'D',
			</otherwise>
		</choose>
		now(), 'demo', #{compSeq}, #{langCode}, #{compName},
		null, #{ownerName}, null, #{bizCondition}, #{item}, #{addr}, #{detailAddr}, #{useYn}, 
		<if test="opCode eq 'I'.toString()">
			'0101', now(),
		</if>
		<if test="opCode neq 'I'.toString()">
			#{createSeq}, #{createDate}, 
		</if>
		#{modifySeq}, #{modifyDate}, null  )
	</insert>
	
	<select id="getCompAll" parameterType="companyvo" resultType="companyvo">
		select comp_seq as compSeq, group_seq as groupSeq, comp_cd as compCd, login_type as loginType, comp_regist_num as compRegistNum,
				comp_num as compNum, standard_code as standardCode, erp_use as erpUse, tel_num as telNum, fax_num as faxNum, homepg_addr as homepg_Addr,
				comp_mail_url as compMailUrl, comp_domain as compDomain, email_addr as emailAddr, email_domain as emailDomain, zip_code as zipCode, 
				sms_use as smsUse, sms_id as smsId, sms_passwd as smsPasswd, native_lang_code as nativeLangCode, order_num as orderNum, use_yn as useYn, 
				ea_type as eaType, create_seq as createSeq, create_date as createDate, modify_seq as modifySeq, modify_date as modifyDate, 
				comp_email_yn as compEmailYn, erp_use_yn as erpUseYn, sms_use_yn as smsUseYn
		from t_co_comp
		where comp_seq = #{compSeq}
	</select>
	
	<select id="getCompMultiAll" parameterType="companyvo" resultType="companyvo">
		select comp_seq as compSeq, lang_code as langCode, group_seq as groupSeq, comp_name as compName, comp_display_name as compDisplayName, 
				owner_name as ownerName, sender_name as senderName, biz_condition as bizCondition, item, addr, detail_addr as detailAddr, 
				use_yn as useYn, create_seq as createSeq, create_date as createDate, modify_seq as modifySeq, modify_date as modifyDate, comp_nickname as compNickname
		from t_co_comp_multi
		where comp_seq = #{compSeq}
		and lang_code = #{langCode}
	</select>
	
	<update id="updateParentDept" parameterType="map">
		update t_co_dept set parent_dept_seq = #{parentDeptSeq},
		<if test="parentDeptSeq gte 1000000">
			biz_seq = #{parentDeptSeq}
		</if>
		<if test="parentDeptSeq lt 1000000">
			biz_seq = (select * from(select a.biz_seq from t_co_dept a where a.dept_seq = #{parentDeptSeq}) a)
		</if>
		where dept_seq = #{deptSeq}
	</update>
	
	<select id="getDeptForTree" parameterType="string" resultType="departmentsvo">
		select a.dept_seq as deptSeq, a.group_seq as groupSeq, a.comp_seq as compSeq,
	    	 a.biz_seq as bizSeq, a.parent_dept_seq as parentDeptSeq, a.dept_name as deptName, a.dept_level as deptLevel, 
	    	 a.childCount as childCount, a.deptEmpCount as deptEmpCount, c.dept_name as deptNameEn
		from (select a.dept_seq, a.group_seq, a.comp_seq,
		    	 a.biz_seq, a.parent_dept_seq, b.dept_name, a.dept_level, 
		    	 (select count(*) from t_co_dept c where parent_dept_seq = a.dept_seq) as childCount,
		    	 (select count(emp_seq) from t_co_emp_dept where dept_seq = a.dept_seq) as deptEmpCount
			from t_co_dept a, t_co_dept_multi b
			where a.dept_seq = b.dept_seq
			and b.lang_code = 'kr'
			and a.use_yn = 'Y'
			and b.use_yn = 'Y'
			and a.dept_seq = #{seq}) a
		left outer join t_co_dept_multi c
		on a.dept_seq = c.dept_seq
		and c.lang_code = 'en'
		order by substring(a.dept_name, 3) + 0
	</select>
	
	<insert id="insertBiz" parameterType="bizvo">
		insert into t_co_biz values( #{bizSeq}, #{bizSeq}, 'demo', #{compSeq}, null, null, null, null,
					 null, #{zipCode}, null, 'kr', #{orderNum}, #{useYn}, null, '0101', now(), null, null)
	</insert>
	
	<insert id="insertBizMulti" parameterType="bizvo">
		insert into t_co_biz_multi values( #{bizSeq}, #{langCode}, 'demo', #{compSeq}, #{bizName}, null,
			null, null, #{bizNickname}, null, #{addr}, #{detailAddr}, #{useYn}, '0101', now(), null, null)
	</insert>
	
	<insert id="insertDept" parameterType="departmentsvo">
		insert into t_co_dept values( #{deptSeq}, #{deptSeq}, 'demo', #{compSeq},
		<if test="parentDeptSeq gte 10000000">
			#{parentDeptSeq},
		</if>
		<if test="parentDeptSeq lt 10000000">
			(select a.biz_seq from t_co_dept as a where a.dept_seq = #{parentDeptSeq}),
		</if>
		  #{parentDeptSeq}, null, 
			null, null, null, #{zipCode}, null, null, null, 'kr', null, null, 
		<if test="parentDeptSeq gte 10000000">
			1,
		</if>
		<if test="parentDeptSeq lt 10000000">
			(select b.dept_level from t_co_dept as b where b.dept_seq = #{parentDeptSeq})+1,
		</if>
		#{orderNum}, #{useYn}, '0101', now(), null, null, null, 'Y')
	</insert>
	
	<insert id="insertDeptMulti" parameterType="departmentsvo">
		insert into t_co_dept_multi values( #{langCode}, #{deptSeq}, 'demo', #{compSeq},
		<if test="parentDeptSeq gte 10000000">
			#{parentDeptSeq},
		</if>
		<if test="parentDeptSeq lt 10000000">
			(select a.biz_seq from t_co_dept as a where a.dept_seq = #{parentDeptSeq}),
		</if>
		#{deptName}, null, null, #{addr}, #{detailAddr}, null, #{useYn}, '0101', now(), null, null, #{deptNickname})
	</insert>
</mapper> 